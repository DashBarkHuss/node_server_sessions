<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script>
    const makePayload = (payload)=>{
        return { method: 'post', 
        headers: {'Accept':'application/json'}, 
        body: JSON.stringify(payload)
        }
    }    
    const register = (payload) => {
        payload = makePayload(payload);
        fetch('api/user/register', payload
            ).then(promise=>promise.json()
            ).then(content=>console.log(content))
    }
    const login = (payload) => {
        payload = makePayload(payload);
        fetch('api/user/login', payload
            ).then(promise=>promise.json()
            ).then(json=> {
                console.log("json: ", json)
                if (json.success) localStorage.setItem('token', json.token);
            }).catch((error) => { console.log("err29:", error) });
    }
    const logout = () => {
        fetch('api/user/logout'
        ).then(promise=>promise.json()
        ).then(content => {
            console.log("content:",content);
            localStorage.removeItem('token');
        })
    }
    const getSession = (payload)=>{
        payload = makePayload(payload);
        console.log(payload);
        fetch('api/session/get', payload)
        .then(promise=>promise.json())
        .then(content => console.log(content));
    }
    </script>
</head>
<body>
    <h2>Register</h2>
    <input type= "text" id="regusername"></input>
    <input type="password" id="regpassword"></input>
    <input type="button" value="Register" onclick="register({'username':window.regusername.value, 'password':window.regpassword.value, 'token': localStorage.getItem('token')})"></input>
    <h2>Login</h2>
    <input type="text" id = "username"></input>
    <input type="password" id = "password"></input>
    <input type="button" value="Login" 
    onclick="login({'username':window.username.value, 'password': window.password.value, 'token': localStorage.getItem('token')})" >
    </input>

    <h2>Logged In:</h2>
    <input type="button" value="Check Who's Logged In" onclick="getSession({'token': localStorage.getItem('token')})"></input>
    <div id="LoggedInUserName"></div>

    <br>
    <input type="button" value="Logout" onclick="logout()"></input>
</body>
</html>